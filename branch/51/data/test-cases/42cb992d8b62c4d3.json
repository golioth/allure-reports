{"uid":"42cb992d8b62c4d3","name":"test_fw_update","fullName":"modules.lib.golioth-firmware-sdk.examples.zephyr.fw_update.pytest.test_sample#test_fw_update","historyId":"e35d87be40a3f24a162aaab8c9432c62","time":{"start":1736584617811,"stop":1736584725957,"duration":108146},"status":"failed","statusMessage":"AssertionError: Expected firmware version \"255.8.9\" but got \"%s\"\nassert '1.2.3' == '255.8.9'\n  \n  - 255.8.9\n  + 1.2.3","statusTrace":"shell = <twister_harness.helpers.shell.Shell object at 0xffff956c8f50>\nproject = <golioth.golioth.Project object at 0xffff956a3110>\ndevice = <golioth.golioth.Device object at 0xffff956ca790>\nwifi_ssid = '***TIMS_ORANGE_PI_WIFI_SSID***', wifi_psk = '***TIMS_ORANGE_PI_WIFI_PSK***'\nfw_info = {'package': 'main', 'version': '255.8.9'}\nrelease = Release <67822d9474b8809ed71a48be, release_tags=[], device_tags=['67822d9374b8809ed71a48bd'], artifact_ids=['674e19b9509873c6f7445233'], rollout=False>\n\n    async def test_fw_update(shell, project, device, wifi_ssid, wifi_psk, fw_info, release):\n    \n        # Wait for app to start running or 10 seconds to pass so runtime settings are ready.\n    \n        try:\n            shell._device.readlines_until(regex=\".*Start FW Update sample.\", timeout=10.0)\n        except:\n            pass\n    \n        # Set Golioth credential\n    \n        golioth_cred = (await device.credentials.list())[0]\n        shell.exec_command(f\"settings set golioth/psk-id {golioth_cred.identity}\")\n        shell.exec_command(f\"settings set golioth/psk {golioth_cred.key}\")\n    \n        # Set WiFi credential\n    \n        if wifi_ssid is not None:\n            shell.exec_command(f\"settings set wifi/ssid \\\"{wifi_ssid}\\\"\")\n    \n        if wifi_psk is not None:\n            shell.exec_command(f\"settings set wifi/psk \\\"{wifi_psk}\\\"\")\n    \n        # Wait for first manifest to arrive (no update expected)\n    \n        shell._device.readlines_until(regex=\".*Nothing to do.\", timeout=90.0)\n    \n    \n        # Rollout the release\n    \n        await project.releases.rollout_set(release.id, True)\n    \n        # Monitor block download and watch for reboot after update\n    \n        shell._device.readlines_until(regex=\".*Received block.\", timeout=90.0)\n        LOGGER.info(\"Block download has begun!\")\n    \n        shell._device.readlines_until(regex=\".*Rebooting into new image.\", timeout=600.0)\n        LOGGER.info(\"Download complete, restarting to perform update.\")\n    \n        # Test for board to run new firmware and report to Golioth\n    \n        shell._device.readlines_until(regex=f\".*Current firmware version: {fw_info['package']} - {fw_info['version']}.\",\n                                      timeout=120.0)\n        LOGGER.info(\"Device reported expected update version\")\n    \n        shell._device.readlines_until(regex=\".*Nothing to do.\", timeout=30.0)\n        LOGGER.info(\"Device received manifest confirming successful upgrade.\")\n    \n        # Check cloud for reported firmware version\n    \n        device_check = await project.device_by_name(device.name)\n    \n        d_package = device_check.info['metadata']['update']['main']['package']\n        d_version = device_check.info['metadata']['update']['main']['version']\n    \n        assert d_package == fw_info['package'], f'Expected firmware package \"{fw_info[\"package\"]}\" but got \"%s\"'.format(d_package)\n>       assert d_version == fw_info['version'], f'Expected firmware version \"{fw_info[\"version\"]}\" but got \"%s\"'.format(d_version)\nE       AssertionError: Expected firmware version \"255.8.9\" but got \"%s\"\nE       assert '1.2.3' == '255.8.9'\nE         \nE         - 255.8.9\nE         + 1.2.3\n\nmodules/lib/golioth-firmware-sdk/examples/zephyr/fw_update/pytest/test_sample.py:67: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"anyio_backend","time":{"start":1736584592457,"stop":1736584592457,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"wifi_psk","time":{"start":1736584592458,"stop":1736584592458,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"wifi_ssid","time":{"start":1736584592458,"stop":1736584592458,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"fw_info","time":{"start":1736584592459,"stop":1736584592588,"duration":129},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_key","time":{"start":1736584592589,"stop":1736584592589,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_url","time":{"start":1736584592589,"stop":1736584592589,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"twister_harness_config","time":{"start":1736584592590,"stop":1736584592591,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device_name","time":{"start":1736584592590,"stop":1736584592590,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device_object","time":{"start":1736584592591,"stop":1736584592594,"duration":3},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project","time":{"start":1736584592595,"stop":1736584593046,"duration":451},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1736584593047,"stop":1736584593923,"duration":876},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"blueprint_id","time":{"start":1736584593924,"stop":1736584594302,"duration":378},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"artifact","time":{"start":1736584594303,"stop":1736584594710,"duration":407},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tag","time":{"start":1736584594710,"stop":1736584595999,"duration":1289},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"release","time":{"start":1736584596000,"stop":1736584596427,"duration":427},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dut","time":{"start":1736584596427,"stop":1736584616782,"duration":20355},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"shell","time":{"start":1736584616783,"stop":1736584617808,"duration":1025},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: Expected firmware version \"255.8.9\" but got \"%s\"\nassert '1.2.3' == '255.8.9'\n  \n  - 255.8.9\n  + 1.2.3","statusTrace":"shell = <twister_harness.helpers.shell.Shell object at 0xffff956c8f50>\nproject = <golioth.golioth.Project object at 0xffff956a3110>\ndevice = <golioth.golioth.Device object at 0xffff956ca790>\nwifi_ssid = '***TIMS_ORANGE_PI_WIFI_SSID***', wifi_psk = '***TIMS_ORANGE_PI_WIFI_PSK***'\nfw_info = {'package': 'main', 'version': '255.8.9'}\nrelease = Release <67822d9474b8809ed71a48be, release_tags=[], device_tags=['67822d9374b8809ed71a48bd'], artifact_ids=['674e19b9509873c6f7445233'], rollout=False>\n\n    async def test_fw_update(shell, project, device, wifi_ssid, wifi_psk, fw_info, release):\n    \n        # Wait for app to start running or 10 seconds to pass so runtime settings are ready.\n    \n        try:\n            shell._device.readlines_until(regex=\".*Start FW Update sample.\", timeout=10.0)\n        except:\n            pass\n    \n        # Set Golioth credential\n    \n        golioth_cred = (await device.credentials.list())[0]\n        shell.exec_command(f\"settings set golioth/psk-id {golioth_cred.identity}\")\n        shell.exec_command(f\"settings set golioth/psk {golioth_cred.key}\")\n    \n        # Set WiFi credential\n    \n        if wifi_ssid is not None:\n            shell.exec_command(f\"settings set wifi/ssid \\\"{wifi_ssid}\\\"\")\n    \n        if wifi_psk is not None:\n            shell.exec_command(f\"settings set wifi/psk \\\"{wifi_psk}\\\"\")\n    \n        # Wait for first manifest to arrive (no update expected)\n    \n        shell._device.readlines_until(regex=\".*Nothing to do.\", timeout=90.0)\n    \n    \n        # Rollout the release\n    \n        await project.releases.rollout_set(release.id, True)\n    \n        # Monitor block download and watch for reboot after update\n    \n        shell._device.readlines_until(regex=\".*Received block.\", timeout=90.0)\n        LOGGER.info(\"Block download has begun!\")\n    \n        shell._device.readlines_until(regex=\".*Rebooting into new image.\", timeout=600.0)\n        LOGGER.info(\"Download complete, restarting to perform update.\")\n    \n        # Test for board to run new firmware and report to Golioth\n    \n        shell._device.readlines_until(regex=f\".*Current firmware version: {fw_info['package']} - {fw_info['version']}.\",\n                                      timeout=120.0)\n        LOGGER.info(\"Device reported expected update version\")\n    \n        shell._device.readlines_until(regex=\".*Nothing to do.\", timeout=30.0)\n        LOGGER.info(\"Device received manifest confirming successful upgrade.\")\n    \n        # Check cloud for reported firmware version\n    \n        device_check = await project.device_by_name(device.name)\n    \n        d_package = device_check.info['metadata']['update']['main']['package']\n        d_version = device_check.info['metadata']['update']['main']['version']\n    \n        assert d_package == fw_info['package'], f'Expected firmware package \"{fw_info[\"package\"]}\" but got \"%s\"'.format(d_package)\n>       assert d_version == fw_info['version'], f'Expected firmware version \"{fw_info[\"version\"]}\" but got \"%s\"'.format(d_version)\nE       AssertionError: Expected firmware version \"255.8.9\" but got \"%s\"\nE       assert '1.2.3' == '255.8.9'\nE         \nE         - 255.8.9\nE         + 1.2.3\n\nmodules/lib/golioth-firmware-sdk/examples/zephyr/fw_update/pytest/test_sample.py:67: AssertionError","steps":[],"attachments":[{"uid":"12df58520efe4a33","name":"log","source":"12df58520efe4a33.txt","type":"text/plain","size":190898}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"dut::0","time":{"start":1736584726127,"stop":1736584726136,"duration":9},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"release::0","time":{"start":1736584726138,"stop":1736584726523,"duration":385},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tag::0","time":{"start":1736584726525,"stop":1736584727328,"duration":803},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"artifact::0","time":{"start":1736584727330,"stop":1736584727330,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"blueprint_id::0","time":{"start":1736584727332,"stop":1736584727333,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device::0","time":{"start":1736584727335,"stop":1736584727745,"duration":410},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project::0","time":{"start":1736584727748,"stop":1736584727748,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device_object::0","time":{"start":1736584727750,"stop":1736584727750,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"fw_info::0","time":{"start":1736584727778,"stop":1736584727792,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"esp32_devkitc_wrover"},{"name":"tag","value":"zephyr"},{"name":"parentSuite","value":"sample.zephyr.esp32_devkitc_wrover"},{"name":"tag","value":"tims_orange_pi"},{"name":"tag","value":"@pytest.mark.usefixtures('anyio_backend')"},{"name":"tag","value":"anyio"},{"name":"suite","value":"test_sample"},{"name":"host","value":"64de5463ef13"},{"name":"thread","value":"371-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"modules.lib.golioth-firmware-sdk.examples.zephyr.fw_update.pytest.test_sample"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"board_name","value":"'esp32_devkitc_wrover'"},{"name":"platform_name","value":"'zephyr'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":27,"skipped":0,"passed":13,"unknown":0,"total":41},"items":[{"uid":"88d503664aba6a65","reportUrl":"https://golioth.github.io/allure-reports/branch/47//#testresult/88d503664aba6a65","status":"passed","time":{"start":1736529902798,"stop":1736530034822,"duration":132024}},{"uid":"cf78cc32978dd82f","reportUrl":"https://golioth.github.io/allure-reports/branch/46//#testresult/cf78cc32978dd82f","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736525703391,"stop":1736525908844,"duration":205453}},{"uid":"89fc4e44f540cff8","reportUrl":"https://golioth.github.io/allure-reports/branch/43//#testresult/89fc4e44f540cff8","status":"passed","time":{"start":1736453523164,"stop":1736453634395,"duration":111231}},{"uid":"7f8ddcd323efeedb","reportUrl":"https://golioth.github.io/allure-reports/branch/42//#testresult/7f8ddcd323efeedb","status":"passed","time":{"start":1736449974740,"stop":1736450154232,"duration":179492}},{"uid":"3f69bcc0de01d3f6","reportUrl":"https://golioth.github.io/allure-reports/branch/43//#testresult/3f69bcc0de01d3f6","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736445774528,"stop":1736445974831,"duration":200303}},{"uid":"ae9f3abfb5367109","reportUrl":"https://golioth.github.io/allure-reports/branch/42//#testresult/ae9f3abfb5367109","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736441372359,"stop":1736441574553,"duration":202194}},{"uid":"4fda430d5739036a","reportUrl":"https://golioth.github.io/allure-reports/branch/39//#testresult/4fda430d5739036a","status":"passed","time":{"start":1736437263265,"stop":1736437364474,"duration":101209}},{"uid":"540f0dc5d1143edc","reportUrl":"https://golioth.github.io/allure-reports/branch/39//#testresult/540f0dc5d1143edc","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736432658206,"stop":1736432856797,"duration":198591}},{"uid":"548d2823429d294b","reportUrl":"https://golioth.github.io/allure-reports/branch/26/#testresult/548d2823429d294b","status":"passed","time":{"start":1736375826786,"stop":1736376001344,"duration":174558}},{"uid":"369d7956210d1467","reportUrl":"https://golioth.github.io/allure-reports/branch/26/#testresult/369d7956210d1467","status":"passed","time":{"start":1736375826786,"stop":1736376001344,"duration":174558}},{"uid":"d574d897cce701ab","reportUrl":"https://golioth.github.io/allure-reports/branch/27/#testresult/d574d897cce701ab","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736374933560,"stop":1736375132372,"duration":198812}},{"uid":"c46e68d02c9ba49d","reportUrl":"https://golioth.github.io/allure-reports/branch/5/#testresult/c46e68d02c9ba49d","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736357053971,"stop":1736357160487,"duration":106516}},{"uid":"9e27626f3df1c4f8","reportUrl":"https://golioth.github.io/allure-reports/branch/4/#testresult/9e27626f3df1c4f8","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736354344468,"stop":1736354456073,"duration":111605}},{"uid":"3f7a9821383a70fd","reportUrl":"https://golioth.github.io/allure-reports/branch/29/#testresult/3f7a9821383a70fd","status":"passed","time":{"start":1736361079287,"stop":1736361259238,"duration":179951}},{"uid":"9a0d66632b03d577","reportUrl":"https://golioth.github.io/allure-reports/branch/27/#testresult/9a0d66632b03d577","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736284498294,"stop":1736284702278,"duration":203984}},{"uid":"6aebc1daaf399bba","reportUrl":"https://golioth.github.io/allure-reports/branch/26/#testresult/6aebc1daaf399bba","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736283572491,"stop":1736283772583,"duration":200092}},{"uid":"854252bc51749a23","reportUrl":"https://golioth.github.io/allure-reports/branch/25//#testresult/854252bc51749a23","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736275693760,"stop":1736275898428,"duration":204668}},{"uid":"c833a0c75ac19615","reportUrl":"https://golioth.github.io/allure-reports/branch/24/#testresult/c833a0c75ac19615","status":"passed","time":{"start":1736271059546,"stop":1736271155852,"duration":96306}},{"uid":"2cde71b3a9488c74","reportUrl":"https://golioth.github.io/allure-reports/branch/1/#testresult/2cde71b3a9488c74","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736224646190,"stop":1736224756774,"duration":110584}},{"uid":"8ad3ada5540006bc","reportUrl":"https://golioth.github.io/allure-reports/branch/20/#testresult/8ad3ada5540006bc","status":"broken","statusDetails":"twister_harness.exceptions.TwisterHarnessTimeoutException: Read from device timeout occurred","time":{"start":1736218406236,"stop":1736218601460,"duration":195224}}]},"tags":["anyio","tims_orange_pi","esp32_devkitc_wrover","@pytest.mark.usefixtures('anyio_backend')","zephyr"]},"source":"42cb992d8b62c4d3.json","parameterValues":["'esp32_devkitc_wrover'","'zephyr'"]}