{"uid":"fbb2266707d1bf42","name":"test_stream","fullName":"modules.lib.golioth-firmware-sdk.examples.zephyr.stream.pytest.test_sample#test_stream","historyId":"92fec5fac7da5ac3a26deeb8207f2647","time":{"start":1727400348118,"stop":1727400456774,"duration":108656},"status":"broken","statusMessage":"trio_websocket._impl.ConnectionClosed","statusTrace":"shell = <twister_harness.helpers.shell.Shell object at 0xffff93f316d0>\ndevice = <golioth.golioth.Device object at 0xffff93f4c610>\nwifi_ssid = '***SAMS_ORANGE_PI_WIFI_SSID***', wifi_psk = '***SAMS_ORANGE_PI_WIFI_PSK***'\n\n    async def test_stream(shell, device, wifi_ssid, wifi_psk):\n        await trio.sleep(2)\n    \n        # Set Golioth credential\n    \n        golioth_cred = (await device.credentials.list())[0]\n        shell.exec_command(f\"settings set golioth/psk-id {golioth_cred.identity}\")\n        shell.exec_command(f\"settings set golioth/psk {golioth_cred.key}\")\n    \n        # Set WiFi credential\n    \n        if wifi_ssid is not None:\n            shell.exec_command(f\"settings set wifi/ssid \\\"{wifi_ssid}\\\"\")\n    \n        if wifi_psk is not None:\n            shell.exec_command(f\"settings set wifi/psk \\\"{wifi_psk}\\\"\")\n    \n        # Verify temp messages\n    \n        temp = 20.0\n        async with contextlib.aclosing(device.stream.iter()) as stream_iter:\n>           async for value in stream_iter:\n\nmodules/lib/golioth-firmware-sdk/examples/zephyr/stream/pytest/test_sample.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.11/dist-packages/golioth/golioth.py:618: in iter\n    yield await monitor.get()\n/usr/local/lib/python3.11/dist-packages/golioth/golioth.py:157: in get\n    msg = await self.ws.get_message()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <trio_websocket._impl.WebSocketConnection object at 0xffff93f6b390>\n\n    async def get_message(self):\n        '''\n        Receive the next WebSocket message.\n    \n        If no message is available immediately, then this function blocks until\n        a message is ready.\n    \n        If the remote endpoint closes the connection, then the caller can still\n        get messages sent prior to closing. Once all pending messages have been\n        retrieved, additional calls to this method will raise\n        ``ConnectionClosed``. If the local endpoint closes the connection, then\n        pending messages are discarded and calls to this method will immediately\n        raise ``ConnectionClosed``.\n    \n        :rtype: str or bytes\n        :raises ConnectionClosed: if the connection is closed.\n        '''\n        try:\n            message = await self._recv_channel.receive()\n        except (trio.ClosedResourceError, trio.EndOfChannel):\n>           raise ConnectionClosed(self._close_reason) from None\nE           trio_websocket._impl.ConnectionClosed\n\n/usr/local/lib/python3.11/dist-packages/trio_websocket/_impl.py:892: ConnectionClosed","flaky":true,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"anyio_backend","time":{"start":1727400317340,"stop":1727400317341,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"wifi_ssid","time":{"start":1727400317341,"stop":1727400317341,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"wifi_psk","time":{"start":1727400317342,"stop":1727400317342,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device_name","time":{"start":1727400317342,"stop":1727400317342,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"twister_harness_config","time":{"start":1727400317343,"stop":1727400317343,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device_object","time":{"start":1727400317343,"stop":1727400317345,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_key","time":{"start":1727400317346,"stop":1727400317346,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_url","time":{"start":1727400317347,"stop":1727400317347,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project","time":{"start":1727400317347,"stop":1727400318169,"duration":822},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1727400318170,"stop":1727400319517,"duration":1347},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dut","time":{"start":1727400319518,"stop":1727400347003,"duration":27485},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"shell","time":{"start":1727400347004,"stop":1727400348113,"duration":1109},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"broken","statusMessage":"trio_websocket._impl.ConnectionClosed","statusTrace":"shell = <twister_harness.helpers.shell.Shell object at 0xffff93f316d0>\ndevice = <golioth.golioth.Device object at 0xffff93f4c610>\nwifi_ssid = '***SAMS_ORANGE_PI_WIFI_SSID***', wifi_psk = '***SAMS_ORANGE_PI_WIFI_PSK***'\n\n    async def test_stream(shell, device, wifi_ssid, wifi_psk):\n        await trio.sleep(2)\n    \n        # Set Golioth credential\n    \n        golioth_cred = (await device.credentials.list())[0]\n        shell.exec_command(f\"settings set golioth/psk-id {golioth_cred.identity}\")\n        shell.exec_command(f\"settings set golioth/psk {golioth_cred.key}\")\n    \n        # Set WiFi credential\n    \n        if wifi_ssid is not None:\n            shell.exec_command(f\"settings set wifi/ssid \\\"{wifi_ssid}\\\"\")\n    \n        if wifi_psk is not None:\n            shell.exec_command(f\"settings set wifi/psk \\\"{wifi_psk}\\\"\")\n    \n        # Verify temp messages\n    \n        temp = 20.0\n        async with contextlib.aclosing(device.stream.iter()) as stream_iter:\n>           async for value in stream_iter:\n\nmodules/lib/golioth-firmware-sdk/examples/zephyr/stream/pytest/test_sample.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.11/dist-packages/golioth/golioth.py:618: in iter\n    yield await monitor.get()\n/usr/local/lib/python3.11/dist-packages/golioth/golioth.py:157: in get\n    msg = await self.ws.get_message()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <trio_websocket._impl.WebSocketConnection object at 0xffff93f6b390>\n\n    async def get_message(self):\n        '''\n        Receive the next WebSocket message.\n    \n        If no message is available immediately, then this function blocks until\n        a message is ready.\n    \n        If the remote endpoint closes the connection, then the caller can still\n        get messages sent prior to closing. Once all pending messages have been\n        retrieved, additional calls to this method will raise\n        ``ConnectionClosed``. If the local endpoint closes the connection, then\n        pending messages are discarded and calls to this method will immediately\n        raise ``ConnectionClosed``.\n    \n        :rtype: str or bytes\n        :raises ConnectionClosed: if the connection is closed.\n        '''\n        try:\n            message = await self._recv_channel.receive()\n        except (trio.ClosedResourceError, trio.EndOfChannel):\n>           raise ConnectionClosed(self._close_reason) from None\nE           trio_websocket._impl.ConnectionClosed\n\n/usr/local/lib/python3.11/dist-packages/trio_websocket/_impl.py:892: ConnectionClosed","steps":[],"attachments":[{"uid":"7f501bbf41bca117","name":"log","source":"7f501bbf41bca117.txt","type":"text/plain","size":14674}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"dut::0","time":{"start":1727400457231,"stop":1727400457281,"duration":50},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device::0","time":{"start":1727400457282,"stop":1727400462843,"duration":5561},"status":"broken","statusMessage":"httpx.ReadTimeout\n","statusTrace":"  File \"/usr/local/lib/python3.11/dist-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py\", line 907, in _teardown_yield_fixture\n    next(it)\n  File \"/usr/local/lib/python3.11/dist-packages/anyio/pytest_plugin.py\", line 75, in wrapper\n    yield from runner.run_asyncgen_fixture(func, kwargs)\n  File \"/usr/local/lib/python3.11/dist-packages/anyio/_backends/_trio.py\", line 823, in run_asyncgen_fixture\n    self._call_in_runner_task(asyncgen.asend, None)\n  File \"/usr/local/lib/python3.11/dist-packages/anyio/_backends/_trio.py\", line 810, in _call_in_runner_task\n    return outcome_holder[0].unwrap()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/outcome/_impl.py\", line 213, in unwrap\n    raise captured_error\n  File \"/usr/local/lib/python3.11/dist-packages/anyio/_backends/_trio.py\", line 780, in _run_tests_and_fixtures\n    retval = await coro\n             ^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/golioth/pytest_plugin.py\", line 68, in device\n    await project.delete_device(device)\n  File \"/usr/local/lib/python3.11/dist-packages/golioth/golioth.py\", line 257, in delete_device\n    await self.delete_device_by_id(dev.id)\n  File \"/usr/local/lib/python3.11/dist-packages/golioth/golioth.py\", line 254, in delete_device_by_id\n    await self.delete(f'devices/{id}')\n  File \"/usr/local/lib/python3.11/dist-packages/golioth/golioth.py\", line 80, in wrapper\n    resp: httpx.Response = await func(*args, **kwargs)\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/golioth/golioth.py\", line 118, in delete\n    return await c.delete(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_client.py\", line 2012, in delete\n    return await self.request(\n           ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_client.py\", line 1585, in request\n    return await self.send(request, auth=auth, follow_redirects=follow_redirects)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_client.py\", line 1674, in send\n    response = await self._send_handling_auth(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_client.py\", line 1702, in _send_handling_auth\n    response = await self._send_handling_redirects(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_client.py\", line 1739, in _send_handling_redirects\n    response = await self._send_single_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_client.py\", line 1776, in _send_single_request\n    response = await transport.handle_async_request(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_transports/default.py\", line 376, in handle_async_request\n    with map_httpcore_exceptions():\n  File \"/usr/lib/python3.11/contextlib.py\", line 155, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/dist-packages/httpx/_transports/default.py\", line 89, in map_httpcore_exceptions\n    raise mapped_exc(message) from exc\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"project::0","time":{"start":1727400462848,"stop":1727400462855,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device_object::0","time":{"start":1727400462866,"stop":1727400462866,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"nrf9160dk"},{"name":"tag","value":"zephyr"},{"name":"parentSuite","value":"sample.zephyr.nrf9160dk"},{"name":"tag","value":"sams_orange_pi"},{"name":"tag","value":"@pytest.mark.usefixtures('anyio_backend')"},{"name":"tag","value":"anyio"},{"name":"suite","value":"test_sample"},{"name":"host","value":"ca12409e67a3"},{"name":"thread","value":"593-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"modules.lib.golioth-firmware-sdk.examples.zephyr.stream.pytest.test_sample"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"board_name","value":"'nrf9160dk'"},{"name":"platform_name","value":"'zephyr'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":2,"broken":1,"skipped":0,"passed":15,"unknown":0,"total":18},"items":[{"uid":"9ae49a08b907cb82","reportUrl":"https://golioth.github.io/allure-reports/1450//#testresult/9ae49a08b907cb82","status":"passed","time":{"start":1727395141484,"stop":1727395171862,"duration":30378}},{"uid":"77a1b21b4ccbf585","reportUrl":"https://golioth.github.io/allure-reports/1461//#testresult/77a1b21b4ccbf585","status":"passed","time":{"start":1727392885603,"stop":1727392911072,"duration":25469}},{"uid":"1b5261112149a50e","reportUrl":"https://golioth.github.io/allure-reports/1462//#testresult/1b5261112149a50e","status":"failed","statusDetails":"AssertionError: assert 22 == 21.5","time":{"start":1727392146578,"stop":1727392183659,"duration":37081}},{"uid":"42727ce8f0b5d6d2","reportUrl":"https://golioth.github.io/allure-reports/1457//#testresult/42727ce8f0b5d6d2","status":"failed","statusDetails":"AssertionError: assert 21.5 == 21.0","time":{"start":1727386439718,"stop":1727386467974,"duration":28256}},{"uid":"3d34ef0918a20814","reportUrl":"https://golioth.github.io/allure-reports/1452//#testresult/3d34ef0918a20814","status":"passed","time":{"start":1727384106792,"stop":1727384133582,"duration":26790}},{"uid":"e1e5ffbb9b76b8a8","reportUrl":"https://golioth.github.io/allure-reports/1447//#testresult/e1e5ffbb9b76b8a8","status":"passed","time":{"start":1727381072110,"stop":1727381103612,"duration":31502}},{"uid":"edbd9d1cdcb723af","reportUrl":"https://golioth.github.io/allure-reports/1433//#testresult/edbd9d1cdcb723af","status":"passed","time":{"start":1727375281523,"stop":1727375307461,"duration":25938}},{"uid":"df5132c820ce038d","reportUrl":"https://golioth.github.io/allure-reports/1438//#testresult/df5132c820ce038d","status":"passed","time":{"start":1727370806831,"stop":1727370834128,"duration":27297}},{"uid":"96354e5fd82b942f","reportUrl":"https://golioth.github.io/allure-reports/1437//#testresult/96354e5fd82b942f","status":"passed","time":{"start":1727369192439,"stop":1727369218508,"duration":26069}},{"uid":"54bb38859cad6588","reportUrl":"https://golioth.github.io/allure-reports/1433//#testresult/54bb38859cad6588","status":"passed","time":{"start":1727361832949,"stop":1727361859368,"duration":26419}},{"uid":"7a6406b9c6b004db","reportUrl":"https://golioth.github.io/allure-reports/1432//#testresult/7a6406b9c6b004db","status":"passed","time":{"start":1727316142420,"stop":1727316168558,"duration":26138}},{"uid":"4cbe6946c4eca817","reportUrl":"https://golioth.github.io/allure-reports/1429//#testresult/4cbe6946c4eca817","status":"passed","time":{"start":1727313218547,"stop":1727313247061,"duration":28514}},{"uid":"d2438c6256d56e3d","reportUrl":"https://golioth.github.io/allure-reports/1424//#testresult/d2438c6256d56e3d","status":"passed","time":{"start":1727306984340,"stop":1727307009006,"duration":24666}},{"uid":"fe6481667d1d938e","reportUrl":"https://golioth.github.io/allure-reports/1421//#testresult/fe6481667d1d938e","status":"passed","time":{"start":1727296065118,"stop":1727296087848,"duration":22730}},{"uid":"ecedf69258e88f9d","reportUrl":"https://golioth.github.io/allure-reports/1420//#testresult/ecedf69258e88f9d","status":"passed","time":{"start":1727289893859,"stop":1727289918210,"duration":24351}},{"uid":"68638c47b81ff74e","reportUrl":"https://golioth.github.io/allure-reports/1419//#testresult/68638c47b81ff74e","status":"passed","time":{"start":1727285916646,"stop":1727285938148,"duration":21502}},{"uid":"9caa4c9a761d2ddd","reportUrl":"https://golioth.github.io/allure-reports/1417//#testresult/9caa4c9a761d2ddd","status":"passed","time":{"start":1727283699682,"stop":1727283721222,"duration":21540}}]},"tags":["nrf9160dk","anyio","sams_orange_pi","@pytest.mark.usefixtures('anyio_backend')","zephyr"]},"source":"fbb2266707d1bf42.json","parameterValues":["'nrf9160dk'","'zephyr'"]}